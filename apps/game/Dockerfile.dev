# Use Go image with tools for development
FROM golang:1.25

# Set working dir
WORKDIR /app

# Copy go.mod and go.sum first (for dependency caching)
COPY go.mod go.sum ./
RUN go mod download

# Copy source code
COPY . .

# Install air for hot-reloading
RUN go install github.com/air-verse/air@latest

# Install curl (needed for healthcheck) without strict verification
RUN apt-get update || true \
    && apt-get install -y --allow-unauthenticated curl \
    && rm -rf /var/lib/apt/lists/*

# Expose the service port
EXPOSE 5001

# Use Air for live-reloading
CMD ["air"]